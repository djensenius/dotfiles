---
name: 'Lint Fish Files'
on:  # yamllint disable-line rule:truthy
  - push
  - pull_request
jobs:
  fishlint:
    name: 'Lint Fish Files'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v4
      - name: 'Install Fish Shell'
        run: |
          sudo apt-get update
          sudo apt-get install -y fish
      - name: 'Syntax Check Fish Files'
        run: |
          # Find all .fish files in the fish directory
          find ./fish -name "*.fish" -type f | while read -r file; do
            echo "Checking syntax of $file"
            fish --no-execute "$file" || exit 1
          done
      - name: 'Check Fish File Formatting'
        run: |
          # Check if fish_indent would make changes
          find ./fish -name "*.fish" -type f | while read -r file; do
            echo "Checking formatting of $file"
            if ! diff -u "$file" <(fish_indent < "$file"); then
              echo "File $file is not properly formatted."
              echo "Run 'fish_indent -w $file' to fix."
              exit 1
            fi
          done
